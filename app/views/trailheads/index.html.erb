<h1>Trailhead List</h1>

<hr>
Upload new trailheads (this will replace all of your organization's current data!)
<br><br>
<%= form_tag({ action: :upload }, multipart: true) do %>
  <% if current_user.admin? %>
  <%= select_tag "source_id", options_from_collection_for_select(Organization.all, :id, :code) %>
  <% else %>
  <%= hidden_field_tag 'source_id', current_user.organization.id %>
  <% end %>
  <%= file_field_tag 'trailheads' %><br>
  <%= submit_tag "Submit", data: { confirm: 'Are you sure? This will replace all of your existing trailhead data.' } %>
<% end %>
<hr>
<% if current_user.admin? %>
Showing all trailheads.
<% else %>
<%= link_to "Show all trailheads", :action => "index", :all => "true" %>

<%= link_to "Show #{current_user.organization.code} trailheads only", :action => "index", :all => "false" %>
<% end %>

<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Source</th>
      <th>Steward</th>
      <th>Trails</th>
      <th colspan=3>Action</th>
      <th></th>
      <th></th>
    </tr>
  </thead>

  <tbody>
    <% @trailheads.each do |trailhead| %>
      <tr>
        <td><%= trailhead.name %></td>
        <td><%= trailhead.source.code %></td>
        <td><%= trailhead.steward.code %></td>
        <td>
          <ul>
          <% %w[trail1 trail2 trail3 trail4 trail5 trail6].each do |trail| %>
            <% if !(trailhead["#{trail}"].nil?) && trailhead["#{trail}"].size > 1 %>
              <li><%= trailhead["#{trail}"] %></li>
            <% end %>
          <% end %>
          </ul>
        </td>
        <% if (current_user.admin? || current_user.organization == trailhead.source) %>
        <td><%= link_to 'Show', trailhead %></td>
        <td><%= link_to 'Edit', edit_trailhead_path(trailhead) %></td>
        <td><%= link_to 'Destroy', trailhead, method: :delete, data: { confirm: 'Are you sure?' } %></td>
        <% end %>
      </tr>
    <% end %>
  </tbody>
</table>

<br>

